# Kubernetes 实践指南

[序言](README.md)

# 集群搭建

- [附录](deploy/appendix/README.md)
  - [使用 Terraform 批量创建腾讯云服务器](deploy/appendix/batch-create-machines-with-terraform.md)

# 集群网络

- [常见问题](networking/faq/README.md)
  - [为什么要开 bridge-nf-call-iptables?](networking/faq/why-enable-bridge-nf-call-iptables.md)
  - [ipvs 连接复用引发的系列问题](networking/faq/ipvs-conn-reuse-mode.md)

# 实用技巧

- [高效使用 kubectl](trick/kubectl/README.md)
  - [使用 kubectl-aliases 缩短命令](trick/kubectl/kubectl-aliases.md)
  - [使用 kubectx 和 kubens 快速切换](trick/kubectl/quick-switch-with-kubectx.md)
  - [使用 kubecm 合并 kubeconfig](trick/kubectl/merge-kubeconfig-with-kubecm.md)
  - [使用 kubectl get --raw](trick/kubectl/kubectl-get-raw.md)
  - [Node 相关](trick/kubectl/kubectl-node.md)
  - [Pod 相关](trick/kubectl/kubectl-pod.md)
- [证书签发](trick/certs/README.md)
  - [使用 cfssl 生成证书](trick/certs/sign-certs-with-cfssl.md)
  - [使用 cert-manager 签发免费证书](trick/certs/sign-free-certs-with-cert-manager.md)
  - [为 dnspod 的域名签发免费证书](trick/certs/sign-free-certs-for-dnspod.md)
- [用户与权限](trick/user-and-permissions/README.md)
  - [使用 CSR API 创建用户](trick/user-and-permissions/create-user-using-csr-api.md)
- [部署与配置](trick/deploy/README.md)
  - [为 Pod 设置内核参数](trick/deploy/set-sysctl.md)
- [构建镜像](trick/build-images/README.md)
  - [使用 Podman 构建镜像](trick/build-images/podman.md)

# 最佳实践

- [优雅终止](best-practices/graceful-shutdown/README.md)
  - [Pod 销毁流程](best-practices/graceful-shutdown/pod-termination-proccess.md)
  - [业务代码处理 SIGTERM 信号](best-practices/graceful-shutdown/code-example-of-handle-sigterm.md)
  - [为什么收不到 SIGTERM 信号?](best-practices/graceful-shutdown/why-cannot-receive-sigterm.md)
  - [在 SHELL 中传递信号](best-practices/graceful-shutdown/propagating-signals-in-shell.md)
  - [合理使用 preStop](best-practices/graceful-shutdown/use-prestop.md)
  - [长连接场景](best-practices/graceful-shutdown/persistent-connection.md)
  - [LB 直通 Pod 场景](best-practices/graceful-shutdown/lb-to-pod-directly.md)
- [健康检查配置](best-practices/configure-healthcheck.md)
- [合理设置 Request 与 Limit](best-practices/request-limit.md)
- [Pod 性能优化](best-practices/performance-optimization/README.md)
  - [网络性能调优](best-practices/performance-optimization/network.md)
  - [Pod 绑定 NUMA 亲和性](best-practices/performance-optimization/single-numa-node.md)
- [高可用部署](best-practices/ha/README.md)
  - [Pod 打散调度](best-practices/ha/pod-split-up-scheduling.md)
  - [工作负载平滑升级](best-practices/ha/smooth-upgrade.md)
- [DNS](best-practices/dns/README.md)
  - [自定义域名解析](best-practices/dns/customize-dns-resolution.md)
  - [CoreDNS 性能优化](best-practices/dns/optimize-coredns-performance.md)
- [弹性伸缩](best-practices/autoscaling/README.md)
  - [调节 HPA 扩缩容灵敏度](best-practices/autoscaling/hpa-velocity.md)
  - [HPA 使用自定义指标进行伸缩](best-practices/autoscaling/hpa-with-custom-metrics.md)
- [应用容器化](best-practices/containerization/README.md)
  - [在容器内使用 systemd](best-practices/containerization/systemd-in-container.md)
  - [Java 应用容器化](best-practices/containerization/java-container.md)
  - [在容器中使用 crontab](best-practices/containerization/crontab-in-container.md)
- [集群运维](best-practices/ops/README.md)
  - [安全维护或下线节点](best-practices/ops/securely-maintain-or-offline-node.md)
  - [安全变更容器数据盘路径](best-practices/ops/securely-modify-container-root-dir.md)
  - [大规模集群优化](best-practices/ops/large-scale-cluster-optimization.md)
  - [ETCD 优化](best-practices/ops/etcd-optimization.md)
  - [使用 Ansible 批量操作节点](best-practices/ops/batch-operate-node-with-ansible.md)
- [日志采集](best-practices/logging.md)

# 故障排查

- [排障技能](troubleshooting/skill/README.md)
  - [Linux 常用排查命令](troubleshooting/skill/linux.md)
  - [使用 nsenter 进入 netns](troubleshooting/skill/network/enter-netns-with-nsenter.md)
  - [使用 ksniff 远程抓包](troubleshooting/skill/network/remote-capture-with-ksniff.md)
  - [使用 Systemtap 定位疑难杂症](troubleshooting/skill/kernel/use-systemtap-to-locate-problems.md)
  - [使用 tcpdump 抓包与分析](troubleshooting/skill/network/tcpdump.md)
  - [使用 wireshark 分析数据包](troubleshooting/skill/network/wireshark.md)
- [Pod 排障](troubleshooting/pod/README.md)
  - [Pod 状态异常](troubleshooting/pod/status/README.md)
    - [Terminating](troubleshooting/pod/status/pod-terminating.md)
      - [device or resource busy](troubleshooting/pod/status/device-or-resource-busy.md)
    - [Pending](troubleshooting/pod/status/pod-pending.md)
    - [ContainerCreating 或 Waiting](troubleshooting/pod/status/pod-containercreating-or-waiting.md)
    - [CrashLoopBackOff](troubleshooting/pod/status/pod-crash.md)
    - [ImagePullBackOff](troubleshooting/pod/status/pod-imagepullbackoff.md)
  - [健康检查失败](troubleshooting/pod/healthcheck-failed.md)
- [节点排障](troubleshooting/node/README.md)
  - [节点 Crash 与 Vmcore 分析](troubleshooting/node/node-crash-and-vmcore.md)
  - [节点高负载](troubleshooting/node/node-high-load.md)
    - [IO 高负载](troubleshooting/node/io-high-load.md)
  - [内存碎片化](troubleshooting/node/memory-fragmentation.md)
  - [磁盘爆满](troubleshooting/node/disk-full.md)
  - [PID 爆满](troubleshooting/node/pid-full.md)
  - [ARP 表爆满](troubleshooting/node/arp-cache-overflow.md)
  - [inotify 资源耗尽](troubleshooting/node/runnig-out-of-inotify-watches.md)
  - [soft lockup (内核软死锁)](troubleshooting/node/kernel-solft-lockup.md)
  - [no space left on device](troubleshooting/node/no-space-left-on-device.md)
  - [IPVS no destination available](troubleshooting/node/ipvs-no-destination-available.md)
  - [cAdvisor 无数据](troubleshooting/node/cadvisor-no-data.md)
- [网络排障](troubleshooting/network/README.md)
  - [网络超时](troubleshooting/network/timeout.md)
  - [网络丢包](troubleshooting/network/packet-loss.md)
  - [网络不通](troubleshooting/network/network-unreachable.md)
  - [网速差](troubleshooting/network/slow-network-traffic.md)
  - [DNS 解析异常](troubleshooting/network/dns-exception.md)
  - [CLOSE_WAIT 堆积](troubleshooting/network/close-wait-stacking.md)
  - [排查流量激增](troubleshooting/network/traffic-surge.md)
- [存储排障](troubleshooting/storage/README.md)
  - [Unable to mount volumes](troubleshooting/storage/unable-to-mount-volumes.md)
- [集群排障](troubleshooting/cluster/README.md)
  - [Namespace 一直 Terminating](troubleshooting/cluster/namespace-terminating.md)
- [排障案例](troubleshooting/cases/README.md)
  - [运行时故障](troubleshooting/cases/runtime/README.md)
    - [磁盘 IO 过高导致 Pod 创建超时](troubleshooting/cases/runtime/io-high-load-causing-pod-creation-timeout.md)
    - [高版本 containerd 下载镜像失败](troubleshooting/cases/runtime/pull-image-fail-in-high-version-containerd.md)
    - [挂载根目录导致 device or resource busy](troubleshooting/cases/runtime/mount-root-causing-device-or-resource-busy.md)
    - [系统时间被修改导致 sandbox 冲突](troubleshooting/cases/runtime/broken-system-time-causing-sandbox-conflicts.md)
  - [网络故障](troubleshooting/cases/network/README.md)
    - [DNS 5 秒延时](troubleshooting/cases/network/dns-lookup-5s-delay.md)
    - [ARP 爆满导致健康检查失败](troubleshooting/cases/network/arp-cache-overflow-causing-healthcheck-failed.md)
    - [tcp_tw_recycle 导致跨 VPC 访问 NodePort 超时](troubleshooting/cases/network/cross-vpc-connect-nodeport-timeout.md)
    - [dns id 冲突导致解析异常](troubleshooting/cases/network/musl-libc-dns-id-conflict-causing-dns-abnormal.md)
  - [高负载](troubleshooting/cases/high-load/README.md)
    - [容器磁盘满导致 CPU 飙高](troubleshooting/cases/high-load/disk-full-causing-high-cpu.md)
  - [集群故障](troubleshooting/cases/cluster/README.md)
    - [误删 rancher 的 namespace 导致 node 被清空](troubleshooting/cases/cluster/delete-rancher-ns-causing-node-disappear.md)
    - [调度器 cache 快照遗漏部分信息导致 pod pending](troubleshooting/cases/cluster/scheduler-snapshot-missing-causing-pod-pending.md)
    - [kubectl 执行 exec 或 logs 失败](troubleshooting/cases/cluster/kubectl-exec-or-logs-failed.md)
  - [节点排障](troubleshooting/cases/node/README.md)
    - [cgroup 泄露](troubleshooting/cases/node/cgroup-leaking.md)
  - [其它排障](troubleshooting/cases/others/README.md)
    - [多容器场景下修改 hosts 失效](troubleshooting/cases/others/failed-to-modify-hosts-in-multiple-container.md)
    - [Job 无法被删除](troubleshooting/cases/others/job-cannot-delete.md)
    - [.Net Core 配置文件无法热加载](troubleshooting/cases/others/dotnet-configuration-cannot-auto-reload.md)

# 腾讯云容器服务

- [网络指南](tencent/networking/README.md)
  - [启用 CLB 直通 Pod](tencent/networking/clb-to-pod-directly.md)
  - [Pod 绑 EIP](tencent/networking/how-to-use-eip.md)
  - [IPVS 模式安装 localdns](tencent/networking/install-localdns-with-ipvs.md)
- [存储指南](tencent/storage/README.md)
  - [扩容 CBS 类型的 PVC](tencent/storage/cbs-pvc-expansion.md)
  - [定义 ReadOnlyMany 存储的方法](tencent/storage/readonlymany-pv.md)
- [镜像与仓库](tencent/images/README.md)
  - [使用软件源加速软件包安装](tencent/images/use-mirror-in-container.md)
  - [使用海外容器镜像](tencent/images/use-foreign-container-image.md)
- [故障排查](tencent/troubleshooting/README.md)
  - [排查公网服务不通](tencent/troubleshooting/public-service-or-ingress-connect-failed.md)
- [常见问题](tencent/faq/README.md)
  - [修改 rp_filter 导致网路异常](tencent/faq/modify-rp-filter-causing-exception.md)
  - [CLB 回环问题](tencent/faq/clb-loopback.md)
  - [controller-manager 和 scheduler 状态显示 Unhealthy](tencent/faq/controller-manager-and-scheduler-unhealthy.md)
- [附录](tencent/appendix/README.md)
  - [实用 kubectl 脚本](tencent/appendix/useful-kubectl-for-tencent-cloud.md)
  - [EKS 注解](tencent/appendix/eks-annotations.md)
  - [Ingress 错误码](tencent/appendix/ingress-error-code.md)
    
# 服务网格

- [istio](mesh/istio.md)
